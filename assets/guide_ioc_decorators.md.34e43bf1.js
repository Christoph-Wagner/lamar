import{_ as n,c as a,o as s,a as t}from"./app.35d600bb.js";const h='{"title":"Decorators, Interceptors, and Activators","description":"","frontmatter":{},"headers":[{"level":2,"title":"Decorators","slug":"decorators"},{"level":2,"title":"Activators","slug":"activators"},{"level":2,"title":"Interceptors","slug":"interceptors"}],"relativePath":"guide/ioc/decorators.md","lastUpdated":1644423598327}',e={},p=t(`<h1 id="decorators-interceptors-and-activators" tabindex="-1">Decorators, Interceptors, and Activators <a class="header-anchor" href="#decorators-interceptors-and-activators" aria-hidden="true">#</a></h1><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>If you need some kind of interception policy that doesn&#39;t fit into the admittedly simpler examples shown here, just ask for help in the <a href="https://gitter.im/JasperFx/Lamar" target="_blank" rel="noopener noreferrer">Lamar Gitter room</a>.</p></div><p>Lamar v5 finally added the full complement of interceptors that users have grown to expect from .Net IoC containers. To differentiate between the three terms, Lamar now supports:</p><ol><li><em>Decorators</em> - the classic <a href="https://en.wikipedia.org/wiki/Decorator_pattern" target="_blank" rel="noopener noreferrer">Gang of Four Decorator</a> pattern where at runtime Lamar will &quot;wrap&quot; a concrete decorator object around the registered service</li><li><em>Interceptors</em> - in a user supplied Lambda, get a chance to work with the newly built object or even return a different object with a possibly <a href="https://stackoverflow.com/questions/933993/what-are-dynamic-proxy-classes-and-why-would-i-use-one" target="_blank" rel="noopener noreferrer">dynamic proxy</a></li><li><em>Activators</em> - a user supplied Lambda that is called right after an object is created by Lamar, but before it is returned to the caller</li></ol><h2 id="decorators" tabindex="-1">Decorators <a class="header-anchor" href="#decorators" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>When you use a decorator in Lamar, it effectively replaces the original registration with a new registration for the concrete decorator type, then moves the original registration to be an inline dependency of the decorated type. Be aware that the <code>WhatDoIHave()</code> display will show the concrete decorator type instead of the original registration because of this.</p></div><p>If you look in the Lamar codebase, you&#39;ll find dozens of tests that use a fake type named <code>IWidget</code> that <em>does something</em>:</p><p><a id="snippet-sample_iwidget"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IWidget</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/StructureMap.Testing.Widget/IWidget.cs#L7-L12" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_iwidget" title="Start of snippet">anchor</a></sup></p><p>Let&#39;s say that we have service registrations in our system for that <code>IWidget</code> interface, but we want each of them to be decorated by another form of <code>IWidget</code> like this to perform some kind of cross cutting concern before and/or after the call to the specific widget:</p><p><a id="snippet-sample_widgetholder-decorator"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">WidgetDecorator</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IWidget</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token function">WidgetDecorator</span><span class="token punctuation">(</span><span class="token class-name">IThing</span> thing<span class="token punctuation">,</span> <span class="token class-name">IWidget</span> inner<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        Inner <span class="token operator">=</span> inner<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name">IWidget</span> Inner <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// do something before </span>
        Inner<span class="token punctuation">.</span><span class="token function">DoSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// do something after</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/decorators.cs#L234-L251" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_widgetholder-decorator" title="Start of snippet">anchor</a></sup></p><p>We can configure Lamar to add a decorator around all other <code>IWidget</code> registrations with this syntax:</p><p><a id="snippet-sample_decorator-sample"></a></p><div class="language-cs"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Container</span><span class="token punctuation">(</span>_ <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// This usage adds the WidgetHolder as a decorator</span>
    <span class="token comment">// on all IWidget registrations</span>
    _<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DecorateAllWith</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WidgetDecorator<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// The AWidget type will be decorated w/ </span>
    <span class="token comment">// WidgetHolder when you resolve it from the container</span>
    _<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Use</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    _<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IThing<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Use</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Thing<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Just proving that it actually works;)</span>
container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetInstance</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ShouldBeOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>WidgetDecorator<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span>Inner<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ShouldBeOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>AWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/decorators.cs#L17-L36" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_decorator-sample" title="Start of snippet">anchor</a></sup></p><h2 id="activators" tabindex="-1">Activators <a class="header-anchor" href="#activators" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Activators have to be synchronous at this point, so there might have to be some <code>GetAwaiter().GetResult()</code> action happening to force asynchronous methods to run inline. #sadtrombone.</p></div><p>An <em>activator</em> gives you the chance to make some kind of call against an object that has just been built by Lamar, but before that object is passed to the original service requester.</p><p>As an example, let&#39;s say that you have some sort of service in your system that is responsible for polling an external web service for more information. If you&#39;re like me, you really don&#39;t like to perform any kind of work besides putting together necessary state in a constructor function, so you likely have some kind of <code>Start()</code> method on the polling service to actually start things up like this class:</p><p><a id="snippet-sample_poller"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Poller</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPoller</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// start the actual polling</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// stop polling</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/activation_and_interception.cs#L272-L287" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_poller" title="Start of snippet">anchor</a></sup></p><p>When we register the class above with Lamar, we can supply a Lambda function to start up <code>Poller</code> like this:</p><p><a id="snippet-sample_using_activator_on_one_registration"></a></p><div class="language-cs"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Container</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPoller<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Use</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Poller<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        
        <span class="token comment">// This registers an activator on just this</span>
        <span class="token comment">// one registration</span>
        <span class="token punctuation">.</span><span class="token function">OnCreation</span><span class="token punctuation">(</span>poller <span class="token operator">=&gt;</span> poller<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/activation_and_interception.cs#L291-L302" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_using_activator_on_one_registration" title="Start of snippet">anchor</a></sup></p><p>In the sample above, we registered an activator on one and only one service registration. Lamar will also let you apply an activator across service registrations that implement or inherit from a common type. Back to the polling example, what if we introduce a new marker interface to denote objects that need to be started or activated like this:</p><p><a id="snippet-sample_istartable"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStartable</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IDisposable</span></span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/activation_and_interception.cs#L305-L312" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_istartable" title="Start of snippet">anchor</a></sup><a id="snippet-sample_istartable-1"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStartable</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">bool</span></span> WasStarted <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/container_model_usage.cs#L267-L275" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_istartable-1" title="Start of snippet">anchor</a></sup><a id="snippet-sample_istartable-2"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IStartable</span>
<span class="token punctuation">{</span>
    <span class="token return-type class-name"><span class="token keyword">bool</span></span> WasStarted <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/StructureMap.Testing/Query/ModelIntegrationTester.cs#L188-L196" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_istartable-2" title="Start of snippet">anchor</a></sup></p><p>Now, let&#39;s create a new <code>StartablePoller</code>:</p><p><a id="snippet-sample_startablepoller"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartablePoller</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">IPoller</span><span class="token punctuation">,</span> <span class="token class-name">IStartable</span></span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// shut things down</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// start up the polling</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/activation_and_interception.cs#L314-L328" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_startablepoller" title="Start of snippet">anchor</a></sup></p><p>And going back to the <code>IPoller</code> registration, we could now do this:</p><p><a id="snippet-sample_activator_by_marker_type"></a></p><div class="language-cs"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Container</span><span class="token punctuation">(</span>services <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Remember that Lamar natively understands .Net</span>
    <span class="token comment">// DI registrations w/o any adapter</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPoller<span class="token punctuation">,</span> StartablePoller<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Other registrations that might include other </span>
    <span class="token comment">// IStartable types</span>
    
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IStartable<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">OnCreationForAll</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/activation_and_interception.cs#L332-L347" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_activator_by_marker_type" title="Start of snippet">anchor</a></sup></p><p>The call to <code>For&lt;T&gt;().OnCreationForAll(Action&lt;T&gt;)</code> will apply to any registrations of type <code>T</code> or any registrations where the implementation type can be cast to <code>T</code>. So in th case above, the activator will be applied to the <code>StartablePoller</code> type.</p><p>As a last example, you also have an overload to use the constructing container in an activator if you need access to other services. Let&#39;s say that for some kind of diagnostic in our system, we want to track what <code>IStartable</code> objects have been created and floating around in our system at any time with this simple class:</p><p><a id="snippet-sample_startabletracker"></a></p><div class="language-cs"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StartableTracker</span>
<span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">List<span class="token punctuation">&lt;</span>IStartable<span class="token punctuation">&gt;</span></span> Startables <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">List<span class="token punctuation">&lt;</span>IStartable<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/activation_and_interception.cs#L350-L358" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_startabletracker" title="Start of snippet">anchor</a></sup></p><p>Now, we&#39;d like our <code>IStartable</code> objects to both <code>Start()</code> and be tracked by the class above, so we&#39;ll use an activator like this:</p><p><a id="snippet-sample_startable_and_tracker_registration"></a></p><div class="language-cs"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Container</span><span class="token punctuation">(</span>services <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IPoller<span class="token punctuation">,</span> StartablePoller<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Other registrations that might include other </span>
    <span class="token comment">// IStartable types</span>
    
    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">AddSingleton</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StartableTracker<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    services<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IStartable<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">OnCreationForAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> startable<span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token class-name"><span class="token keyword">var</span></span> tracker <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetInstance</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>StartableTracker<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            tracker<span class="token punctuation">.</span>Startables<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>startable<span class="token punctuation">)</span><span class="token punctuation">;</span>

            startable<span class="token punctuation">.</span><span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/activation_and_interception.cs#L362-L383" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_startable_and_tracker_registration" title="Start of snippet">anchor</a></sup></p><h2 id="interceptors" tabindex="-1">Interceptors <a class="header-anchor" href="#interceptors" aria-hidden="true">#</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The main usage for this feature is most likely for dynamic proxies and Aspect Oriented Programming</p></div><p><em>Interceptors</em> are similar to <em>activators</em>, but with two differences:</p><ol><li><em>Interceptors</em> allow you to return a different object than the one initially created by Lamar</li><li>Because of the potential to return a new object, interceptors are applied at the service type level</li></ol><p>Here&#39;s a sample from the unit tests:</p><p><a id="snippet-sample_intercept_a_single_instance"></a></p><div class="language-cs"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Fact</span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">intercept_a_single_instance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> container <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Container</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span>
    <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ActivatedWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">Named</span><span class="token punctuation">(</span><span class="token string">&quot;yes&quot;</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">OnCreation</span><span class="token punctuation">(</span>w <span class="token operator">=&gt;</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DecoratedWidget</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        x<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">For</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Add</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ActivatedWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Named</span><span class="token punctuation">(</span><span class="token string">&quot;no&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetInstance</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;yes&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ShouldBeOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DecoratedWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span>Inner<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ShouldBeOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ActivatedWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetInstance</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>IWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">&quot;no&quot;</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">ShouldBeOfType</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ActivatedWidget<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre></div><p><sup><a href="https://github.com/JasperFx/lamar/blob/master/src/Lamar.Testing/IoC/Acceptance/activation_and_interception.cs#L87-L110" title="Snippet source file">snippet source</a> | <a href="#snippet-sample_intercept_a_single_instance" title="Start of snippet">anchor</a></sup></p><p>Just like activators, there is the option to only use the original object or the ability to use the original object and the constructing container.</p>`,63),o=[p];function c(i,l,r,u,k,d){return s(),a("div",null,o)}var g=n(e,[["render",c]]);export{h as __pageData,g as default};
