<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Lamar - Lamar Diagnostics</title>
        <link href="/lamar/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/prism.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/theme.css" rel="stylesheet" type="text/css" />

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">

        <link href="/lamar/content/affix.css" rel="stylesheet" type="text/css" />
    </head>

    <body>

      <a href="https://github.com/jasperfx/Lamar"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

      <nav class="navbar navbar-default navbar-fixed-top" role="banner">
      <div class="container">
        <div class="navbar-header">
          <a href="/lamar" class="navbar-brand">Lamar</a>
        </div>
        <nav class="collapse navbar-collapse" role="navigation">
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/lamar/getting_started">Getting Started</a>
            </li>
            <li>
              <a href="/lamar/documentation">Documentation</a>
            </li>
            <li>
              <a href="https://gitter.im/jasperfx/Lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/Lamar" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
            </li>
            <li><a href="/lamar/documentation/ioc/decorators" title="Decorators">Previous</a></li>
            <li><a href="/lamar/documentation/ioc/diagnostics/whatdoihave" title="WhatDoIHave()">Next</a></li>
          </ul>
          <div class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input id="search" type="search" class="form-control" placeholder="Search">
            </div>
          </div>

        </nav>

      </div>
    </nav>

    <div class="container">
      <nav class="navbar-inverse">
        <ol class="breadcrumb"><li><a href="/lamar/">Lamar</a></li><li><a href="/lamar/documentation">Documentation</a></li><li><a href="/lamar/documentation/ioc">Lamar as IoC Container</a></li><li class="active">Lamar Diagnostics</li></ol>
      </nav>
    </div>

    <!--main-->
    <div class="container">
      <div class="row">
          <!--left-->
          <div class="col-md-3" id="leftCol">
            <h3>Lamar 5.0.0</h3>
            <br />

            <ul class="nav nav-stacked affix" id="sidebar">
            </ul>

            <h3 class="no-margin">Next</h3><p><a href="/lamar/documentation/ioc/diagnostics/whatdoihave">WhatDoIHave()</a></p>
            <h3 class="no-margin">Previous</h3><a href="/lamar/documentation/ioc/decorators">Decorators</a></p>
          </div><!--/left-->

          <!--right-->
          <div class="col-md-9">
              <h1>Lamar Diagnostics</h1>

              <hr />

              <div id="main-pane">
                <!--Title: Lamar Diagnostics-->
<p>Like StructureMap before it, one of Lamar's big differentiators from other IoC tools is its strong support for built in diagnostic tools.</p>
<p>The <code>Lamar.Diagnostics</code> Nuget library can be used to expose all of Lamar's diagnostic capabilities
to the command line of your .Net Core or .Net 5.0 systems. To get started, just add a Nuget dependency to <code>Lamar.Diagnostics</code> to your application. This package relies on the .Net command line integration from <a href="https://jasperfx.github.io">Oakton</a>, so you'll need to set up Oakton as shown in this sample <code>Program.Main()</code> method:</p>
<pre><code class="language-csharp">&#xA;static Task&lt;int&gt; Main(string[] args)&#xA;{&#xA;    // Start up your HostBuilder as normal&#xA;    return new HostBuilder()&#xA;        .UseLamar((context, services) =&gt;&#xA;        {&#xA;            // This adds a Container validation&#xA;            // to the Oakton &quot;check-env&quot; command&#xA;            services.CheckLamarConfiguration();&#xA;            &#xA;            // And the rest of your application&#x27;s &#xA;            // DI registrations.&#xA;            services.IncludeRegistry&lt;TestClassRegistry&gt;();&#xA;        })&#xA;        &#xA;        // Call this method to start your application&#xA;        // with Oakton handling the command line parsing&#xA;        // and delegation&#xA;        .RunOaktonCommands(args);&#xA;}&#xA;</code></pre>
<p>Once the <code>Lamar.Diagnostics</code> Nuget is installed to your application and you've opted into Oakton to handle command line options, typing this command at the root of your project will show all the installed commands:</p>
<pre><code>dotnet run -- help
</code></pre>
<p>If <code>Lamar.Diagnostics</code> is installed, you should see three lamar related commands as shown below:</p>
<pre><code>  ---------------------------------------------------------------------------------------------
    Available commands:
  ---------------------------------------------------------------------------------------------
         check-env -&gt; Execute all environment checks against the application
          describe -&gt; Writes out a description of your running application...
              help -&gt; list all the available commands
    lamar-scanning -&gt; Runs Lamar's type scanning diagnostics
    lamar-services -&gt; List all the registered Lamar services
    lamar-validate -&gt; Runs all the Lamar container validations
               run -&gt; Runs the configured AspNetCore application
  ---------------------------------------------------------------------------------------------
</code></pre>
<div class="alert-info alert"><p><strong>Note!</strong>
All the diagnostic commands expose an <code>-e</code> flag to control the host environment name of the running application.</p>
</div>
<h2 id="validating-the-container-configuration">Validating the Container Configuration</h2>
<p>To validate the Lamar configuration of your system, use this command from the root of your project:</p>
<pre><code>dotnet run -- lamar-validate
</code></pre>
<p>Running that command is going to:</p>
<ol>
<li>Bootstrap your application which sets up the Lamar container</li>
<li>Checks that every service registration can find all necessary dependencies</li>
<li>If running in the default &quot;full&quot; mode, tries to build all known registrations one by one</li>
<li>If running in the default &quot;full&quot; mode, executes all the <a href="/lamar/documentation/ioc/diagnostics/environment-tests">Lamar environment checks</a> in your system</li>
<li>Write out the stack traces of any and all exceptions that Lamar encounters</li>
</ol>
<p>If everything checks out, you'll get this friendly output in green:</p>
<pre><code>Lamar registrations are all good!
</code></pre>
<p>Otherwise, you're going to get a whole lot of .Net exception strack traces with explanatory text about what registrations or environment tests failed.</p>
<p>The command itself will return a non zero exit code, so if <code>lamar-validate</code> is used within your automated build, it will fail your build if the validation fails <strong>by design</strong>.</p>
<p>To run a faster check of only the configuration, use the flag shown below:</p>
<pre><code>dotnet run -- lamar-validate ConfigOnly
</code></pre>
<h2 id="analyzing-the-lamar-configuration">Analyzing the Lamar Configuration</h2>
<p>The old Lamar/StructureMap <em>WhatDoIHave()</em> diagnostic report is available from the command line in an enhanced command like this:</p>
<pre><code>dotnet run -- lamar-services
</code></pre>
<p>This command makes heavy usage of the <a href="https://spectresystems.github.io/spectre.console">Spectre.Console</a> library to format the output in a much more readable way than the old, purely textual version.</p>
<p>The output is somewhat ellided to eliminate some of the noise registrations added by <code>HostBuilder</code> like <code>IOptions&lt;T&gt;</code> or <code>ILogger&lt;T&gt;</code>. To see <strong>everything</strong>, use the verbose flag:</p>
<pre><code>dotnet run -- lamar-services --verbose
</code></pre>
<div class="alert-info alert"><p><strong>Note!</strong>
All service registration filtering is done by the <strong>service type</strong> rather than the <strong>implementation type</strong></p>
</div>
<p>To filter the results to zero in on specific type registrations, you can filter by assembly:</p>
<pre><code>dotnet run -- lamar-services --assembly YourAssemblyName
</code></pre>
<p>or by namespace (and this is inclusive):</p>
<pre><code>dotnet run -- lamar-services --namespace NamespaceName
</code></pre>
<p>or by a specific type name:</p>
<pre><code>dotnet run -- lamar-services --type YourTypeName
</code></pre>
<p>The filtering by type name is case insensitive, and looks for type names that contain your filter. So looking for <code>--type options</code> will find every possible registration of <code>IOptions&lt;T&gt;</code> for example.</p>
<p>To get more detailed information about exactly how Lamar is building these service registrations, use this option:</p>
<pre><code>dotnet run -- lamar-services --build-plans
</code></pre>
<p>Lastly, you can save off the output of the <code>lamar-services</code> command to either a text file:</p>
<pre><code>dotnet run -- lamar-services --build-plans --file services.txt
</code></pre>
<p>or keep the formatting in HTML by naming the file with either an <code>htm</code> or <code>html</code> file extension:</p>
<pre><code>dotnet run -- lamar-services --build-plans --file services.htm
</code></pre>
<h2 id="type-scanning-diagnostics">Type Scanning Diagnostics</h2>
<div class="alert-warning alert"><p><strong>Note!</strong>
The type scanning mechanics are somewhat brittle when there are dependency issues in your application, and this command can help you spot where problems may be occurring.</p>
</div>
<p>The <a href="/lamar/documentation/ioc/diagnostics/type-scanning">Type Scanning Diagnostics</a> can be accessed at the command line with this command:</p>
<pre><code>dotnet run -- lamar-scanning
</code></pre>
<h2 id="programmatic-diagnostics">Programmatic Diagnostics</h2>
<p>The older, programmatic usages of Lamar diagnostics are described in other sections:</p>
<ul class="table-of-contents"><li><a href="/lamar/documentation/ioc/diagnostics/whatdoihave">WhatDoIHave()</a></li><li><a href="/lamar/documentation/ioc/diagnostics/validating-container-configuration">Validating Container Configuration</a></li><li><a href="/lamar/documentation/ioc/diagnostics/environment-tests">Environment Tests</a></li><li><a href="/lamar/documentation/ioc/diagnostics/build-plans">Build Plans</a></li><li><a href="/lamar/documentation/ioc/diagnostics/using-the-container-model">Using the Container Model</a></li><li><a href="/lamar/documentation/ioc/diagnostics/type-scanning">Type Scanning Diagnostics</a></li></ul>

              </div>

              <hr />

              <nav>
                <span>
                  <strong>Previous: </strong><a href="/lamar/documentation/ioc/decorators">Decorators</a>

                </span>
                <span class="pull-right">

                  <strong>Next: </strong><a href="/lamar/documentation/ioc/diagnostics/whatdoihave">WhatDoIHave()</a>

                </span>
              </nav>

          </div><!--/right-->
        </div><!--/row-->
      </div><!--/container-->

    </body>


    <footer>
        <script type='text/javascript' src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/lamar/content/prism.js"></script>
        <script type="text/javascript" src="/lamar/content/sidebar.js"></script>
        <script type="text/javascript" src="/lamar/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
    url = encodeURI(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }
});
</script>
    </footer>
</html>
