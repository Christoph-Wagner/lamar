<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta name="generator" content="Bootply" />
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <title>Lamar - Lamar and IDisposable</title>
        <link href="/lamar/content/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/prism.css" rel="stylesheet" type="text/css" />
        <link href="/lamar/content/theme.css" rel="stylesheet" type="text/css" />

        <link rel="apple-touch-icon" href="/bootstrap/img/apple-touch-icon.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/bootstrap/img/apple-touch-icon-72x72.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/bootstrap/img/apple-touch-icon-114x114.png">

        <link href="/lamar/content/affix.css" rel="stylesheet" type="text/css" />
    </head>

    <body>

      <a href="https://github.com/jasperfx/Lamar"><img style="z-index: 5000; position: absolute; top: 0; right: 0; border: 0;" src="https://camo.githubusercontent.com/e7bbb0521b397edbd5fe43e7f760759336b5e05f/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f677265656e5f3030373230302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"></a>

      <nav class="navbar navbar-default navbar-fixed-top" role="banner">
      <div class="container">
        <div class="navbar-header">
          <a href="/lamar" class="navbar-brand">Lamar</a>
        </div>
        <nav class="collapse navbar-collapse" role="navigation">
          <ul class="nav navbar-nav pull-right">
            <li>
              <a href="/lamar/getting_started">Getting Started</a>
            </li>
            <li>
              <a href="/lamar/documentation">Documentation</a>
            </li>
            <li>
              <a href="https://gitter.im/jasperfx/Lamar?utm_source=badge&amp;utm_medium=badge&amp;utm_campaign=pr-badge&amp;utm_content=badge"><img src="https://camo.githubusercontent.com/da2edb525cde1455a622c58c0effc3a90b9a181c/68747470733a2f2f6261646765732e6769747465722e696d2f4a6f696e253230436861742e737667" alt="Join the chat at https://gitter.im/jasperfx/Lamar" data-canonical-src="https://badges.gitter.im/Join%20Chat.svg" style="max-width:100%;"></a>
            </li>
            <li><a href="/lamar/documentation/ioc/injecting-at-runtime" title="Injecting Services at Runtime">Previous</a></li>
            <li><a href="/lamar/documentation/ioc/lazy-resolution" title="Lazy Resolution">Next</a></li>
          </ul>
          <div class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input id="search" type="search" class="form-control" placeholder="Search">
            </div>
          </div>

        </nav>

      </div>
    </nav>

    <div class="container">
      <nav class="navbar-inverse">
        <ol class="breadcrumb"><li><a href="/lamar/">Lamar</a></li><li><a href="/lamar/documentation">Documentation</a></li><li><a href="/lamar/documentation/ioc">Lamar as IoC Container</a></li><li class="active">Lamar and IDisposable</li></ol>
      </nav>
    </div>

    <!--main-->
    <div class="container">
      <div class="row">
          <!--left-->
          <div class="col-md-3" id="leftCol">
            <h3>Lamar 5.0.0</h3>
            <br />

            <ul class="nav nav-stacked affix" id="sidebar">
            </ul>

            <h3 class="no-margin">Next</h3><p><a href="/lamar/documentation/ioc/lazy-resolution">Lazy Resolution</a></p>
            <h3 class="no-margin">Previous</h3><a href="/lamar/documentation/ioc/injecting-at-runtime">Injecting Services at Runtime</a></p>
          </div><!--/left-->

          <!--right-->
          <div class="col-md-9">
              <h1>Lamar and IDisposable</h1>

              <hr />

              <div id="main-pane">
                <!--Title:Lamar and IDisposable-->
<p>One of the main reasons to use an IoC container is to offload the work of disposing created objects at the right time in the application scope. Sure, it's something you should be aware of, but developers are less likely to make mistakes if that's just handled for them.</p>
<h2 id="singletons">Singletons</h2>
<p>This one is easy, any object marked as the <em>Singleton</em> lifecycle that implements <code>IDisposable</code> is disposed when the root container is
disposed:</p>
<pre><code class="language-csharp">&#xA;[Fact]&#xA;public void singletons_are_disposed_when_the_container_is_disposed()&#xA;{&#xA;    var container = new Container(_ =&gt;&#xA;    {&#xA;        _.ForSingletonOf&lt;DisposableSingleton&gt;();&#xA;    });&#xA;&#xA;    // As a singleton-scoped object, every request for DisposableSingleton&#xA;    // will return the same object&#xA;    var singleton = container.GetInstance&lt;DisposableSingleton&gt;();&#xA;    singleton.ShouldBeSameAs(container.GetInstance&lt;DisposableSingleton&gt;());&#xA;    singleton.ShouldBeSameAs(container.GetInstance&lt;DisposableSingleton&gt;());&#xA;    singleton.ShouldBeSameAs(container.GetInstance&lt;DisposableSingleton&gt;());&#xA;    singleton.ShouldBeSameAs(container.GetInstance&lt;DisposableSingleton&gt;());&#xA;&#xA;    singleton.WasDisposed.ShouldBeFalse();&#xA;&#xA;    // now, dispose the Container&#xA;    container.Dispose();&#xA;&#xA;    // the SingletonThing scoped object should be disposed&#xA;    singleton.WasDisposed.ShouldBeTrue();&#xA;}&#xA;&#xA;</code></pre>
<h2 id="nested-containers">Nested Containers</h2>
<p>As discussed in <a href="/lamar/documentation/ioc/nested-containers">Nested Containers (Per Request/Transaction)</a>, any transient or container-scoped object that implements <code>IDisposable</code> and is created
by a nested container will be disposed as the nested container is disposed:</p>
<pre><code class="language-csharp">&#xA;[Fact]&#xA;public void nested_container_disposal()&#xA;{&#xA;    var container = new Container(_ =&gt;&#xA;    {&#xA;        // A SingletonThing scoped service&#xA;        _.ForSingletonOf&lt;IColorCache&gt;().Use&lt;ColorCache&gt;();&#xA;&#xA;        // A transient scoped service&#xA;        _.For&lt;IColor&gt;().Use&lt;Green&gt;();&#xA;&#xA;        &#xA;        &#xA;        // An AlwaysUnique scoped service&#xA;        _.AddTransient&lt;Purple&gt;();&#xA;&#xA;        _.AddTransient&lt;Blue&gt;();&#xA;    });&#xA;&#xA;    ColorCache singleton = null;&#xA;    Green nestedGreen = null;&#xA;    Blue nestedBlue = null;&#xA;    Purple nestedPurple = null;&#xA;&#xA;    using (var nested = container.GetNestedContainer())&#xA;    {&#xA;        // SingletonThing&#x27;s are really built by the parent&#xA;        singleton = nested.GetInstance&lt;IColorCache&gt;()&#xA;            .ShouldBeOfType&lt;ColorCache&gt;();&#xA;&#xA;        nestedGreen = nested.GetInstance&lt;IColor&gt;()&#xA;            .ShouldBeOfType&lt;Green&gt;();&#xA;&#xA;        nestedBlue = nested.GetInstance&lt;Blue&gt;();&#xA;&#xA;        nestedPurple = nested.GetInstance&lt;Purple&gt;();&#xA;    }&#xA;&#xA;    // Transients created by the Nested Container&#xA;    // are disposed&#xA;    nestedGreen.WasDisposed.ShouldBeTrue();&#xA;    nestedBlue.WasDisposed.ShouldBeTrue();&#xA;&#xA;    // Unique&#x27;s created by the Nested Container&#xA;    // are disposed&#xA;    nestedPurple.WasDisposed.ShouldBeTrue();&#xA;&#xA;    // NOT disposed because it&#x27;s owned by&#xA;    // the parent container&#xA;    singleton.WasDisposed.ShouldBeFalse();&#xA;}&#xA;&#xA;</code></pre>
<h2 id="transients">Transients</h2>
<div class="alert-warning alert"><p><strong>Note!</strong>
This behavior is different from StructureMap. Be aware of this, or you may be vulnerable to memory leaks.</p>
</div>
<p>Objects that implement <code>IDisposable</code> are tracked by the container that creates them and will be disposed whenever that container itself is disposed.</p>

              </div>

              <hr />

              <nav>
                <span>
                  <strong>Previous: </strong><a href="/lamar/documentation/ioc/injecting-at-runtime">Injecting Services at Runtime</a>

                </span>
                <span class="pull-right">

                  <strong>Next: </strong><a href="/lamar/documentation/ioc/lazy-resolution">Lazy Resolution</a>

                </span>
              </nav>

          </div><!--/right-->
        </div><!--/row-->
      </div><!--/container-->

    </body>


    <footer>
        <script type='text/javascript' src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script type='text/javascript' src="//netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="/lamar/content/prism.js"></script>
        <script type="text/javascript" src="/lamar/content/sidebar.js"></script>
        <script type="text/javascript" src="/lamar/content/affix.js"></script>

<script>
$('#search').keyup(function(e){
  if(e.keyCode == 13) {
    var search = $('#search').val();

    var url = 'https://www.google.com/#q=site:jasperfx.github.io ' + search;
    url = encodeURI(url);

    window.location.href = url;

    e.stopPropagation();
    if (e.cancelBubble!=null) e.cancelBubble = true;
    return false;
  }
});
</script>
    </footer>
</html>
